<% content_for :title, "Dashboard - FinTrack" %>

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="text-light mb-1">
      <i class="bi bi-speedometer2 me-2"></i>
      Dashboard Financeiro
    </h1>
    <p class="text-muted mb-0">Visão geral das suas finanças</p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to new_income_path, class: "btn btn-success" do %>
      <i class="bi bi-plus-circle me-1"></i> Nova Receita
    <% end %>
    <%= link_to new_expense_path, class: "btn btn-danger" do %>
      <i class="bi bi-dash-circle me-1"></i> Nova Despesa
    <% end %>
  </div>
</div>

  <!-- Summary Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card bg-success border-0 h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="card-subtitle mb-2 text-white opacity-90">Total de Receitas</h6>
              <h3 class="card-title text-white mb-0 fw-bold"><%= number_to_currency(@total_incomes) %></h3>
            </div>
            <div class="bg-white bg-opacity-25 rounded-circle p-2">
              <i class="bi bi-arrow-up-circle text-white fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card bg-danger border-0 h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="card-subtitle mb-2 text-white opacity-90">Total de Despesas</h6>
              <h3 class="card-title text-white mb-0 fw-bold"><%= number_to_currency(@total_expenses) %></h3>
            </div>
            <div class="bg-white bg-opacity-25 rounded-circle p-2">
              <i class="bi bi-arrow-down-circle text-white fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card bg-<%= @balance >= 0 ? 'primary' : 'warning' %> border-0 h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="card-subtitle mb-2 text-white opacity-90">Saldo Atual</h6>
              <h3 class="card-title text-white mb-0 fw-bold"><%= number_to_currency(@balance) %></h3>
            </div>
            <div class="bg-white bg-opacity-25 rounded-circle p-2">
              <i class="bi bi-wallet2 text-white fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts and Categories Section -->
  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card bg-secondary border-0 h-100">
        <div class="card-header bg-transparent border-0 pb-0">
          <h5 class="card-title text-white fw-bold">
            <i class="bi bi-graph-up me-2"></i>
            Receitas por Categoria
          </h5>
        </div>
        <div class="card-body">
          <% if @incomes_by_category.any? %>
            <% @incomes_by_category.each do |category, amount| %>
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex align-items-center">
                  <div class="bg-success rounded-circle me-2" style="width: 8px; height: 8px;"></div>
                  <span class="text-white fw-medium"><%= category %></span>
                </div>
                <span class="text-success fw-bold"><%= number_to_currency(amount) %></span>
              </div>
            <% end %>
          <% else %>
            <div class="text-center py-4">
              <i class="bi bi-pie-chart text-muted display-6"></i>
              <p class="text-muted mt-2">Nenhuma receita encontrada</p>
              <%= link_to "Adicionar primeira receita", new_income_path, class: "btn btn-sm btn-outline-success" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card bg-secondary border-0 h-100">
        <div class="card-header bg-transparent border-0 pb-0">
          <h5 class="card-title text-white fw-bold">
            <i class="bi bi-graph-down me-2"></i>
            Despesas por Categoria
          </h5>
        </div>
        <div class="card-body">
          <% if @expenses_by_category.any? %>
            <% @expenses_by_category.each do |category, amount| %>
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex align-items-center">
                  <div class="bg-danger rounded-circle me-2" style="width: 8px; height: 8px;"></div>
                  <span class="text-white fw-medium"><%= category %></span>
                </div>
                <span class="text-danger fw-bold"><%= number_to_currency(amount) %></span>
              </div>
            <% end %>
          <% else %>
            <div class="text-center py-4">
              <i class="bi bi-pie-chart text-muted display-6"></i>
              <p class="text-muted mt-2">Nenhuma despesa encontrada</p>
              <%= link_to "Adicionar primeira despesa", new_expense_path, class: "btn btn-sm btn-outline-danger" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Transactions -->
  <div class="row">
    <div class="col-12">
      <div class="card bg-secondary border-0">
        <div class="card-header bg-transparent border-0">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title text-white mb-0 fw-bold">
              <i class="bi bi-clock-history me-2"></i>
              Transações Recentes
            </h5>
            <div class="d-flex gap-2">
              <%= link_to incomes_path, class: "btn btn-sm btn-outline-success" do %>
                <i class="bi bi-eye me-1"></i> Ver Receitas
              <% end %>
              <%= link_to expenses_path, class: "btn btn-sm btn-outline-danger" do %>
                <i class="bi bi-eye me-1"></i> Ver Despesas
              <% end %>
            </div>
          </div>
        </div>
        <div class="card-body">
          <% if @recent_transactions.any? %>
            <div class="table-responsive">
              <table class="table table-dark table-hover">
                <thead>
                  <tr>
                    <th>Tipo</th>
                    <th>Descrição</th>
                    <th>Valor</th>
                    <th>Data</th>
                    <th>Categoria</th>
                    <th class="text-end">Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <% @recent_transactions.each do |transaction| %>
                    <tr>
                      <td>
                        <% if transaction.is_a?(Income) %>
                          <span class="badge bg-success">
                            <i class="bi bi-arrow-up me-1"></i>Receita
                          </span>
                        <% else %>
                          <span class="badge bg-danger">
                            <i class="bi bi-arrow-down me-1"></i>Despesa
                          </span>
                        <% end %>
                      </td>
                      <td class="text-white fw-medium"><%= transaction.description %></td>
                      <td class="<%= transaction.is_a?(Income) ? 'text-success' : 'text-danger' %> fw-bold">
                        <%= number_to_currency(transaction.amount) %>
                      </td>
                      <td class="text-muted"><%= transaction.date.strftime("%d/%m/%Y") %></td>
                      <td>
                        <span class="badge bg-dark"><%= transaction.category.name %></span>
                      </td>
                      <td class="text-end">
                        <% if transaction.is_a?(Income) %>
                          <%= link_to income_path(transaction), class: "btn btn-sm btn-outline-light" do %>
                            <i class="bi bi-eye"></i>
                          <% end %>
                        <% else %>
                          <%= link_to expense_path(transaction), class: "btn btn-sm btn-outline-light" do %>
                            <i class="bi bi-eye"></i>
                          <% end %>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="text-center py-5">
              <i class="bi bi-journal-text text-muted display-4"></i>
              <h6 class="text-muted mt-3">Nenhuma transação encontrada</h6>
              <p class="text-muted">Comece adicionando suas primeiras receitas e despesas</p>
              <div class="d-flex gap-2 justify-content-center">
                <%= link_to new_income_path, class: "btn btn-success" do %>
                  <i class="bi bi-plus-circle me-1"></i> Primeira Receita
                <% end %>
                <%= link_to new_expense_path, class: "btn btn-danger" do %>
                  <i class="bi bi-plus-circle me-1"></i> Primeira Despesa
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>


